table inet proxy_rules {
	set lan_ipv4 {
		type ipv4_addr
		flags interval
		elements = {
                  0.0.0.0/8, 10.0.0.0/8,
                  127.0.0.0/8, 192.168.0.0/16,
                  169.254.0.0/16, 240.0.0.0/4,
                  224.0.0.0/4, 172.16.0.0/12
		}
	}

    set lan_ipv6 {
		type ipv6_addr
		flags interval
		elements = {
                  ::/128,
                  ::1/128,
                  ::ffff:0:0/96,
                  fc00::/7,
                  fe80::/10,
                  ff00::/8
		}
	}

	set cn_ipv4 {
		type ipv4_addr
		flags interval
	}

	set cn_ipv6 {
		type ipv6_addr
		flags interval
	}

	chain prerouting {
		type filter hook prerouting priority mangle; policy accept;
		meta mark 0x00000001 goto proxy
		ip daddr @lan_ipv4 accept
		ip6 daddr @lan_ipv6 accept
		ip daddr @cn_ipv4 accept
		ip6 daddr @cn_ipv6 accept
		ct direction reply accept
		goto proxy
	}

	chain output {
		type route hook output priority mangle; policy accept;
		meta mark 0x0000000a accept
		ip daddr @lan_ipv4 accept
		ip6 daddr @lan_ipv6 accept
		ip daddr @cn_ipv4 accept
		ip6 daddr @cn_ipv6 accept
		ct direction reply accept
		meta l4proto { tcp, udp } meta mark set 0x00000001 accept
	}

	chain proxy {
		meta l4proto { tcp, udp } meta mark set 0x00000001 tproxy to :12345 accept
	}
}
